version: "3.9"

networks:
  qi_net:
    external: true     # docker network create qi_net

services:
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: qi-clickhouse
    restart: unless-stopped

    env_file:
      - ../.env
    environment:
      CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT: "1"

    ports:
      - "127.0.0.1:8124:8123"   # host->container HTTP
      - "9001:9000"            # native TCP
      - "9010:9009"            # interserver

    volumes:
      - qi_clickhouse_data:/var/lib/clickhouse
      - qi_clickhouse_logs:/var/log/clickhouse-server
      - ../db/init:/docker-entrypoint-initdb.d:ro

    networks: [qi_net]

volumes:
  qi_clickhouse_data:
  qi_clickhouse_logs: